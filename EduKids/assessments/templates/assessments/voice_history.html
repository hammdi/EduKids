{% extends 'base/base.html' %}
{% load static %}

{% block title %}Voice Assessment History - EduKids{% endblock %}

{% block content %}
<div class="voice-history-section">
    <div class="container py-5">
        <div class="row">
            <div class="col-12">
                <!-- Header -->
                <div class="history-header mb-5">
                    <a href="{% url 'assessments:voice_assessment' %}" class="btn btn-sm btn-outline-secondary mb-3">
                        <i class="fas fa-arrow-left me-2"></i>Back to Voice Assessment
                    </a>
                    
                    <h1 class="display-4 fw-bold history-title mb-3">
                        <i class="fas fa-history me-3"></i>Voice Assessment History
                    </h1>
                    
                    {% if student %}
                    <p class="lead text-muted">
                        Viewing history for: <strong>{{ student.get_full_name }}</strong>
                    </p>
                    {% else %}
                    <p class="lead text-muted">
                        Your voice assessment history and progress
                    </p>
                    {% endif %}
                </div>

                <!-- Assessments List -->
                {% if assessments %}
                <div class="row g-4">
                    {% for assessment in assessments %}
                    <div class="col-md-6 col-lg-4">
                        <div class="assessment-card">
                            <div class="assessment-card-header">
                                <div class="assessment-icon">
                                    <i class="fas fa-microphone"></i>
                                </div>
                                <div class="assessment-date">
                                    {{ assessment.created_at|date:"d M Y" }}
                                    <small class="d-block text-muted">{{ assessment.created_at|time:"H:i" }}</small>
                                </div>
                            </div>
                            
                            <div class="assessment-card-body">
                                <h5 class="assessment-question mb-3">
                                    {{ assessment.question|truncatewords:10 }}
                                </h5>
                                
                                <div class="assessment-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-clock text-primary"></i>
                                        <span>{{ assessment.duration|default:"N/A" }}s</span>
                                    </div>
                                    
                                    {% if assessment.score %}
                                    <div class="stat-item">
                                        <i class="fas fa-star text-warning"></i>
                                        <span>{{ assessment.score }}/100</span>
                                    </div>
                                    {% endif %}
                                    
                                    {% if assessment.emotion %}
                                    <div class="stat-item">
                                        <i class="fas fa-smile text-success"></i>
                                        <span>{{ assessment.emotion|capfirst }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                {% if assessment.transcription %}
                                <div class="assessment-transcription mt-3">
                                    <small class="text-muted d-block mb-1">Transcription:</small>
                                    <p class="mb-0">{{ assessment.transcription|truncatewords:15 }}</p>
                                </div>
                                {% endif %}
                                
                                {% if assessment.feedback %}
                                <div class="assessment-feedback mt-3">
                                    <small class="text-muted d-block mb-1">Feedback:</small>
                                    <p class="mb-0">{{ assessment.feedback|truncatewords:15 }}</p>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="assessment-card-footer">
                                <a href="{% url 'assessments:view_assessment' assessment.id %}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye me-1"></i>View Details
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <div class="empty-icon">
                        <i class="fas fa-microphone-slash"></i>
                    </div>
                    <h3 class="empty-title">No Assessments Yet</h3>
                    <p class="empty-text">
                        {% if student %}
                        This student hasn't completed any voice assessments yet.
                        {% else %}
                        You haven't completed any voice assessments yet. Start your first assessment now!
                        {% endif %}
                    </p>
                    <a href="{% url 'assessments:voice_assessment' %}" class="btn btn-primary btn-lg mt-3">
                        <i class="fas fa-microphone me-2"></i>Start Voice Assessment
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
    .voice-history-section {
        background: linear-gradient(135deg, #FFF9F0 0%, #F0F9FF 100%);
        min-height: 100vh;
    }
    
    .history-title {
        background: linear-gradient(135deg, #8B5CF6, #EC4899);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 800;
    }
    
    .assessment-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .assessment-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.12);
    }
    
    .assessment-card-header {
        background: linear-gradient(135deg, #8B5CF6, #EC4899);
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: white;
    }
    
    .assessment-icon {
        font-size: 2rem;
    }
    
    .assessment-date {
        text-align: right;
        font-weight: 600;
    }
    
    .assessment-card-body {
        padding: 1.5rem;
    }
    
    .assessment-question {
        color: #1F2937;
        font-weight: 700;
        min-height: 60px;
    }
    
    .assessment-stats {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }
    
    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: #F3F4F6;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    .assessment-transcription,
    .assessment-feedback {
        padding: 1rem;
        background: #F9FAFB;
        border-radius: 10px;
        border-left: 3px solid #8B5CF6;
    }
    
    .assessment-transcription p,
    .assessment-feedback p {
        color: #4B5563;
        font-size: 0.9rem;
    }
    
    .assessment-card-footer {
        padding: 1rem 1.5rem;
        background: #F9FAFB;
        border-top: 1px solid #E5E7EB;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    
    .empty-icon {
        font-size: 5rem;
        color: #D1D5DB;
        margin-bottom: 1.5rem;
    }
    
    .empty-title {
        color: #1F2937;
        font-weight: 700;
        margin-bottom: 1rem;
    }
    
    .empty-text {
        color: #6B7280;
        font-size: 1.1rem;
        max-width: 500px;
        margin: 0 auto;
    }
</style>
{% endblock %}
